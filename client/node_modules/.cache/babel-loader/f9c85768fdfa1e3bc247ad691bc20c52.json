{"ast":null,"code":"/**\n * Copyright 2016-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule ReactComponentTreeDevtool\n */\n'use strict';\n\nvar _prodInvariant = require('./reactProdInvariant');\n\nvar ReactCurrentOwner = require('./ReactCurrentOwner');\n\nvar invariant = require('fbjs/lib/invariant');\n\nvar warning = require('fbjs/lib/warning');\n\nvar tree = {};\nvar unmountedIDs = {};\nvar rootIDs = {};\n\nfunction updateTree(id, update) {\n  if (!tree[id]) {\n    tree[id] = {\n      element: null,\n      parentID: null,\n      ownerID: null,\n      text: null,\n      childIDs: [],\n      displayName: 'Unknown',\n      isMounted: false,\n      updateCount: 0\n    };\n  }\n\n  update(tree[id]);\n}\n\nfunction purgeDeep(id) {\n  var item = tree[id];\n\n  if (item) {\n    var childIDs = item.childIDs;\n    delete tree[id];\n    childIDs.forEach(purgeDeep);\n  }\n}\n\nfunction describeComponentFrame(name, source, ownerName) {\n  return '\\n    in ' + name + (source ? ' (at ' + source.fileName.replace(/^.*[\\\\\\/]/, '') + ':' + source.lineNumber + ')' : ownerName ? ' (created by ' + ownerName + ')' : '');\n}\n\nfunction describeID(id) {\n  var name = ReactComponentTreeDevtool.getDisplayName(id);\n  var element = ReactComponentTreeDevtool.getElement(id);\n  var ownerID = ReactComponentTreeDevtool.getOwnerID(id);\n  var ownerName;\n\n  if (ownerID) {\n    ownerName = ReactComponentTreeDevtool.getDisplayName(ownerID);\n  }\n\n  process.env.NODE_ENV !== 'production' ? warning(element, 'ReactComponentTreeDevtool: Missing React element for debugID %s when ' + 'building stack', id) : void 0;\n  return describeComponentFrame(name, element && element._source, ownerName);\n}\n\nvar ReactComponentTreeDevtool = {\n  onSetDisplayName: function onSetDisplayName(id, displayName) {\n    updateTree(id, function (item) {\n      return item.displayName = displayName;\n    });\n  },\n  onSetChildren: function onSetChildren(id, nextChildIDs) {\n    updateTree(id, function (item) {\n      item.childIDs = nextChildIDs;\n      nextChildIDs.forEach(function (nextChildID) {\n        var nextChild = tree[nextChildID];\n        !nextChild ? process.env.NODE_ENV !== 'production' ? invariant(false, 'Expected devtool events to fire for the child before its parent includes it in onSetChildren().') : _prodInvariant('68') : void 0;\n        !(nextChild.displayName != null) ? process.env.NODE_ENV !== 'production' ? invariant(false, 'Expected onSetDisplayName() to fire for the child before its parent includes it in onSetChildren().') : _prodInvariant('69') : void 0;\n        !(nextChild.childIDs != null || nextChild.text != null) ? process.env.NODE_ENV !== 'production' ? invariant(false, 'Expected onSetChildren() or onSetText() to fire for the child before its parent includes it in onSetChildren().') : _prodInvariant('70') : void 0;\n        !nextChild.isMounted ? process.env.NODE_ENV !== 'production' ? invariant(false, 'Expected onMountComponent() to fire for the child before its parent includes it in onSetChildren().') : _prodInvariant('71') : void 0;\n\n        if (nextChild.parentID == null) {\n          nextChild.parentID = id; // TODO: This shouldn't be necessary but mounting a new root during in\n          // componentWillMount currently causes not-yet-mounted components to\n          // be purged from our tree data so their parent ID is missing.\n        }\n\n        !(nextChild.parentID === id) ? process.env.NODE_ENV !== 'production' ? invariant(false, 'Expected onSetParent() and onSetChildren() to be consistent (%s has parents %s and %s).', nextChildID, nextChild.parentID, id) : _prodInvariant('72', nextChildID, nextChild.parentID, id) : void 0;\n      });\n    });\n  },\n  onSetOwner: function onSetOwner(id, ownerID) {\n    updateTree(id, function (item) {\n      return item.ownerID = ownerID;\n    });\n  },\n  onSetParent: function onSetParent(id, parentID) {\n    updateTree(id, function (item) {\n      return item.parentID = parentID;\n    });\n  },\n  onSetText: function onSetText(id, text) {\n    updateTree(id, function (item) {\n      return item.text = text;\n    });\n  },\n  onBeforeMountComponent: function onBeforeMountComponent(id, element) {\n    updateTree(id, function (item) {\n      return item.element = element;\n    });\n  },\n  onBeforeUpdateComponent: function onBeforeUpdateComponent(id, element) {\n    updateTree(id, function (item) {\n      return item.element = element;\n    });\n  },\n  onMountComponent: function onMountComponent(id) {\n    updateTree(id, function (item) {\n      return item.isMounted = true;\n    });\n  },\n  onMountRootComponent: function onMountRootComponent(id) {\n    rootIDs[id] = true;\n  },\n  onUpdateComponent: function onUpdateComponent(id) {\n    updateTree(id, function (item) {\n      return item.updateCount++;\n    });\n  },\n  onUnmountComponent: function onUnmountComponent(id) {\n    updateTree(id, function (item) {\n      return item.isMounted = false;\n    });\n    unmountedIDs[id] = true;\n    delete rootIDs[id];\n  },\n  purgeUnmountedComponents: function purgeUnmountedComponents() {\n    if (ReactComponentTreeDevtool._preventPurging) {\n      // Should only be used for testing.\n      return;\n    }\n\n    for (var id in unmountedIDs) {\n      purgeDeep(id);\n    }\n\n    unmountedIDs = {};\n  },\n  isMounted: function isMounted(id) {\n    var item = tree[id];\n    return item ? item.isMounted : false;\n  },\n  getCurrentStackAddendum: function getCurrentStackAddendum(topElement) {\n    var info = '';\n\n    if (topElement) {\n      var type = topElement.type;\n      var name = typeof type === 'function' ? type.displayName || type.name : type;\n      var owner = topElement._owner;\n      info += describeComponentFrame(name || 'Unknown', topElement._source, owner && owner.getName());\n    }\n\n    var currentOwner = ReactCurrentOwner.current;\n    var id = currentOwner && currentOwner._debugID;\n    info += ReactComponentTreeDevtool.getStackAddendumByID(id);\n    return info;\n  },\n  getStackAddendumByID: function getStackAddendumByID(id) {\n    var info = '';\n\n    while (id) {\n      info += describeID(id);\n      id = ReactComponentTreeDevtool.getParentID(id);\n    }\n\n    return info;\n  },\n  getChildIDs: function getChildIDs(id) {\n    var item = tree[id];\n    return item ? item.childIDs : [];\n  },\n  getDisplayName: function getDisplayName(id) {\n    var item = tree[id];\n    return item ? item.displayName : 'Unknown';\n  },\n  getElement: function getElement(id) {\n    var item = tree[id];\n    return item ? item.element : null;\n  },\n  getOwnerID: function getOwnerID(id) {\n    var item = tree[id];\n    return item ? item.ownerID : null;\n  },\n  getParentID: function getParentID(id) {\n    var item = tree[id];\n    return item ? item.parentID : null;\n  },\n  getSource: function getSource(id) {\n    var item = tree[id];\n    var element = item ? item.element : null;\n    var source = element != null ? element._source : null;\n    return source;\n  },\n  getText: function getText(id) {\n    var item = tree[id];\n    return item ? item.text : null;\n  },\n  getUpdateCount: function getUpdateCount(id) {\n    var item = tree[id];\n    return item ? item.updateCount : 0;\n  },\n  getRootIDs: function getRootIDs() {\n    return Object.keys(rootIDs);\n  },\n  getRegisteredIDs: function getRegisteredIDs() {\n    return Object.keys(tree);\n  }\n};\nmodule.exports = ReactComponentTreeDevtool;","map":null,"metadata":{},"sourceType":"script"}